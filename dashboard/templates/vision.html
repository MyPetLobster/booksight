{% extends "layout.html" %}
{% load static %}

{% block title %}Booksight{% endblock %}
{% block body %}
    <div class="page-identifier" style="display:none">vision</div>
    <div class="idx-content">
        <div class="landing-logo-div-vision">
            <img id="logo-eyes-vision" src="{% static 'dashboard/images/eyes-only.png' %}" alt="Booksight Logo Owl Eyes">
            <img id="logo-text-vision" src="{% static 'dashboard/images/booksight-text.png' %}" alt="Booksight Logo Text">
        </div>
        </br>
            <img class="proc-upload-img" id="uploaded-image-raw" src="{{ image_path }}" alt="Uploaded Image" style="max-width: 350px; max-height: 500px; display: block">
            <img class="proc-upload-img" id=bbox-image" src="" alt="Bounding Box Image" style="max-width: 350px; max-height: 500px; display: none">
            <div class="spine-image-grid" id="spine-image-grid" style="display: none">
                <!-- <img class="proc-upload-img" id="spine-image-1" src="" alt="Spine Image 1" style="max-width: 350px; max-height: 500px; display: none"> -->
            </div>
        </br>
        <div class="vision-para-div">
            <p>
                Your image is processing. Once complete, you will receive an email with a file in the format you specified.
            </p>
            <p>
                If you want to see the process in detail, you can visit the <a class="vision-link" href="https://github.com/MyPetLobster/booksight">Booksight GitHub repository</a> to download the project and 
                run the terminal-based version of the Vision application to see the process in action.
            </p>
            <p>
                <a class="vision-link" href="{% url 'index' %}">Return to the home page</a>
            </p>
        </div>
    </div>

    <script>
    function checkStatus() {
        $.ajax ({
            url: "{% url 'vision_status' %}",
            type: "GET",
            success: function(data) {
                alert(data.status);
                if (data.status == "bbox-detected") {
                    alert("Bounding Box Detected");
                    $("#bbox-image").attr("src", data.bbox_image);
                    $("#bbox-image").css("display", "block");
                } else if (data.status == "spine-detected") {
                    $("#spine-image-grid").css("display", "block");
                    for (var i = 0; i < data.spine_images.length; i++) {
                        var spine_image = $("<img>").attr("src", data.spine_images[i]);
                        spine_image.attr("class", "proc-upload-img");
                        spine_image.attr("style", "max-width: 200px; max-height: 350px; display: block");
                        $("#spine-image-grid").append(spine_image);
                    }
                } else if (data.status == "complete") {
                    clearInterval(statusInterval);
                    window.location.href = "{% url 'vision_complete' %}";
                } else {
                    setTimeout(checkStatus, 10000);
                }
            }
        });
    }

    var statusInterval = setInterval(checkStatus, 10000);
    </script>
{% endblock %}


